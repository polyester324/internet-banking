create table public.clients
(
    id           bigserial
        constraint clients_pk
            primary key,
    first_name   varchar   not null,
    last_name    varchar   not null,
    phone_number varchar   not null,
    created      timestamp not null
);

alter table public.clients
    owner to postgres;

create unique index clients_phone_number_uindex
    on public.clients (phone_number);

create table public.cards
(
    id             bigserial
        constraint cards_pk
            primary key,
    card_number    varchar           not null,
    client_id      bigint            not null
        constraint cards_clients_id_fk
            references public.clients
            on update cascade on delete cascade,
    balance        numeric default 0 not null,
    money_currency varchar           not null,
    created        timestamp         not null
);

alter table public.cards
    owner to postgres;

create unique index cards_card_number_uindex
    on public.cards (card_number);

create trigger t_balance_check
    before insert or update
    on public.cards
    for each row
execute procedure public.check_balance();

